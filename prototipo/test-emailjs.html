<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test EmailJS - Eventify Peru</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #004E89;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .status-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .status-item:last-child { border-bottom: none; }
        .status-label { font-weight: 500; }
        .status-value { font-family: monospace; color: #333; }
        .status-ok { color: #2A9D8F; }
        .status-error { color: #E63946; }
        .status-pending { color: #F7B801; }

        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #FF6B35;
        }
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #FF6B35, #E55A25);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,107,53,0.4);
        }
        .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background: #004E89;
            color: white;
        }

        .log-container {
            margin-top: 30px;
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        .log-title {
            color: #888;
            font-size: 12px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        .log-entry {
            font-family: monospace;
            font-size: 13px;
            padding: 4px 0;
            border-bottom: 1px solid #333;
        }
        .log-entry:last-child { border-bottom: none; }
        .log-info { color: #8BC34A; }
        .log-error { color: #FF5252; }
        .log-warn { color: #FFC107; }
        .log-time { color: #666; margin-right: 10px; }

        .result-box {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }
        .result-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .credentials {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .credentials h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .credentials code {
            background: rgba(0,0,0,0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test EmailJS</h1>
        <p class="subtitle">Prueba el envio de emails para Eventify Peru</p>

        <!-- Credenciales -->
        <div class="credentials">
            <h3>Credenciales Configuradas</h3>
            <p><strong>Public Key:</strong> <code id="showPublicKey">Cargando...</code></p>
            <p><strong>Service ID:</strong> <code id="showServiceId">Cargando...</code></p>
            <p><strong>Template ID:</strong> <code id="showTemplateId">Cargando...</code></p>
        </div>

        <!-- Status -->
        <div class="status-box">
            <div class="status-item">
                <span class="status-label">SDK EmailJS</span>
                <span class="status-value" id="sdkStatus">Verificando...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Inicializacion</span>
                <span class="status-value" id="initStatus">Pendiente</span>
            </div>
            <div class="status-item">
                <span class="status-label">Ultimo envio</span>
                <span class="status-value" id="lastSend">-</span>
            </div>
        </div>

        <!-- Formulario de prueba -->
        <form id="testForm">
            <div class="form-group">
                <label for="testName">Nombre</label>
                <input type="text" id="testName" value="Usuario Prueba" required>
            </div>
            <div class="form-group">
                <label for="testEmail">Email (donde recibiras el correo)</label>
                <input type="email" id="testEmail" placeholder="tu@email.com" required>
            </div>
            <div class="form-group">
                <label for="testType">Tipo de usuario</label>
                <select id="testType">
                    <option value="organizador">Organizador de eventos</option>
                    <option value="dueno_local">Dueno de local</option>
                    <option value="proveedor">Proveedor de servicios</option>
                    <option value="curioso">Curioso</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary" id="sendBtn">
                Enviar Email de Prueba
            </button>
        </form>

        <button class="btn btn-secondary" onclick="clearLogs()" style="margin-top: 10px;">
            Limpiar Logs
        </button>

        <!-- Resultado -->
        <div class="result-box" id="resultBox"></div>

        <!-- Logs -->
        <div class="log-container">
            <div class="log-title">Console Log</div>
            <div id="logOutput"></div>
        </div>
    </div>

    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <script>
        // Credenciales
        const EMAILJS_PUBLIC_KEY = '0dYuscUBKL8b-TRsX';
        const EMAILJS_SERVICE_ID = 'service_ealwt3e';
        const EMAILJS_TEMPLATE_ID = 'template_x0x0gnu';

        // Mostrar credenciales
        document.getElementById('showPublicKey').textContent = EMAILJS_PUBLIC_KEY;
        document.getElementById('showServiceId').textContent = EMAILJS_SERVICE_ID;
        document.getElementById('showTemplateId').textContent = EMAILJS_TEMPLATE_ID;

        // Custom logger
        function log(message, type = 'info') {
            const logOutput = document.getElementById('logOutput');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.innerHTML = `<span class="log-time">[${time}]</span> ${message}`;
            logOutput.appendChild(entry);
            logOutput.scrollTop = logOutput.scrollHeight;

            // Also log to console
            console[type === 'error' ? 'error' : type === 'warn' ? 'warn' : 'log'](message);
        }

        function clearLogs() {
            document.getElementById('logOutput').innerHTML = '';
            log('Logs limpiados', 'info');
        }

        function updateStatus(id, text, ok) {
            const el = document.getElementById(id);
            el.textContent = text;
            el.className = `status-value ${ok ? 'status-ok' : ok === false ? 'status-error' : 'status-pending'}`;
        }

        function showResult(success, message) {
            const box = document.getElementById('resultBox');
            box.style.display = 'block';
            box.className = `result-box ${success ? 'result-success' : 'result-error'}`;
            box.innerHTML = `<strong>${success ? 'EXITO' : 'ERROR'}</strong><br>${message}`;
        }

        // Verificar SDK
        log('Verificando SDK de EmailJS...');
        if (typeof emailjs !== 'undefined') {
            updateStatus('sdkStatus', 'Cargado', true);
            log('SDK de EmailJS cargado correctamente', 'info');

            // Inicializar
            try {
                emailjs.init(EMAILJS_PUBLIC_KEY);
                updateStatus('initStatus', 'OK', true);
                log('EmailJS inicializado con public key: ' + EMAILJS_PUBLIC_KEY, 'info');
            } catch (err) {
                updateStatus('initStatus', 'Error', false);
                log('Error al inicializar: ' + err.message, 'error');
            }
        } else {
            updateStatus('sdkStatus', 'No cargado', false);
            log('ERROR: SDK de EmailJS no encontrado', 'error');
        }

        // Manejar envio
        document.getElementById('testForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const btn = document.getElementById('sendBtn');
            const name = document.getElementById('testName').value;
            const email = document.getElementById('testEmail').value;
            const userType = document.getElementById('testType').value;

            btn.disabled = true;
            btn.textContent = 'Enviando...';
            document.getElementById('resultBox').style.display = 'none';

            log('=== INICIANDO ENVIO ===', 'info');
            log(`Destinatario: ${name} <${email}>`, 'info');
            log(`Tipo: ${userType}`, 'info');

            const templateParams = {
                to_name: name,
                to_email: email,
                user_type: userType
            };

            log('Parametros: ' + JSON.stringify(templateParams), 'info');
            log(`Enviando a service: ${EMAILJS_SERVICE_ID}, template: ${EMAILJS_TEMPLATE_ID}`, 'info');

            try {
                const response = await emailjs.send(
                    EMAILJS_SERVICE_ID,
                    EMAILJS_TEMPLATE_ID,
                    templateParams
                );

                log('RESPUESTA: ' + JSON.stringify(response), 'info');
                log('Email enviado exitosamente!', 'info');

                updateStatus('lastSend', 'OK - ' + new Date().toLocaleTimeString(), true);
                showResult(true, `Email enviado a ${email}.<br>Status: ${response.status}<br>Revisa tu bandeja de entrada (y spam).`);

            } catch (error) {
                log('ERROR: ' + JSON.stringify(error), 'error');
                log('Mensaje: ' + (error.text || error.message || 'Error desconocido'), 'error');

                updateStatus('lastSend', 'Error', false);
                showResult(false, `No se pudo enviar el email.<br>Error: ${error.text || error.message || 'Error desconocido'}<br><br>Posibles causas:<br>- Credenciales incorrectas<br>- Template no existe<br>- Limite de emails alcanzado`);
            }

            log('=== FIN ENVIO ===', 'info');
            btn.disabled = false;
            btn.textContent = 'Enviar Email de Prueba';
        });
    </script>
</body>
</html>
