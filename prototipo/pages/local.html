<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="google-site-verification" content="-WivQeeMjDJ48477slxQm1V3g5Z4kxukvV6vjRAfXcc" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle del Local | Eventify Per√∫</title>
    <meta name="description" content="Informaci√≥n detallada del local para eventos">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Styles -->
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/responsive.css">

    <style>
        .local-page {
            padding-top: var(--header-height);
        }

        /* Gallery */
        .gallery-section {
            background: var(--gray-100);
            padding: var(--spacing-4) 0;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--spacing-3);
            max-height: 480px;
        }

        .gallery-main {
            position: relative;
            border-radius: var(--radius-xl);
            overflow: hidden;
            cursor: pointer;
        }

        .gallery-main img,
        .gallery-main .placeholder {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-main .placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .gallery-side {
            display: grid;
            grid-template-rows: 1fr 1fr;
            gap: var(--spacing-3);
        }

        .gallery-thumb {
            position: relative;
            border-radius: var(--radius-lg);
            overflow: hidden;
            cursor: pointer;
        }

        .gallery-thumb img,
        .gallery-thumb .placeholder {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-thumb .placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
        }

        .gallery-more {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
        }

        /* Content Layout */
        .local-content {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: var(--spacing-8);
            padding: var(--spacing-8) 0;
        }

        /* Main Info */
        .local-main {
            min-width: 0;
        }

        .local-header {
            margin-bottom: var(--spacing-6);
        }

        .local-badges {
            display: flex;
            gap: var(--spacing-2);
            margin-bottom: var(--spacing-3);
        }

        .local-title {
            font-size: var(--font-size-3xl);
            margin-bottom: var(--spacing-2);
        }

        .local-location {
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
            color: var(--text-secondary);
            font-size: var(--font-size-base);
            margin-bottom: var(--spacing-4);
        }

        .local-location i {
            color: var(--primary);
        }

        .local-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-6);
            padding: var(--spacing-4);
            background: var(--gray-50);
            border-radius: var(--radius-lg);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
        }

        .meta-item i {
            color: var(--primary);
            font-size: var(--font-size-lg);
        }

        .meta-item strong {
            color: var(--text-primary);
        }

        .meta-item span {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        /* Sections */
        .info-section {
            margin-bottom: var(--spacing-8);
        }

        .info-section h2 {
            font-size: var(--font-size-xl);
            margin-bottom: var(--spacing-4);
            padding-bottom: var(--spacing-3);
            border-bottom: 2px solid var(--border-light);
        }

        .description {
            color: var(--text-secondary);
            line-height: var(--line-height-relaxed);
        }

        /* Amenities Grid */
        .amenities-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-4);
        }

        .amenity-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
            padding: var(--spacing-3);
            background: var(--gray-50);
            border-radius: var(--radius-lg);
        }

        .amenity-item i {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-50);
            color: var(--primary);
            border-radius: var(--radius-md);
        }

        .amenity-item span {
            font-size: var(--font-size-sm);
            color: var(--text-primary);
        }

        /* Availability */
        .availability-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: var(--spacing-2);
        }

        .day-slot {
            text-align: center;
            padding: var(--spacing-3);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
        }

        .day-slot.available {
            background: var(--success-50);
            color: var(--success);
        }

        .day-slot.unavailable {
            background: var(--gray-100);
            color: var(--text-muted);
        }

        .day-slot .day-name {
            font-weight: var(--font-weight-semibold);
            display: block;
            margin-bottom: var(--spacing-1);
        }

        .day-slot .hours {
            font-size: var(--font-size-xs);
        }

        /* Reviews */
        .reviews-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-5);
        }

        .rating-summary {
            display: flex;
            align-items: center;
            gap: var(--spacing-4);
        }

        .rating-big {
            font-size: var(--font-size-4xl);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
        }

        .rating-details {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-1);
        }

        .rating-stars {
            color: var(--accent);
        }

        .review-card {
            padding: var(--spacing-5);
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-4);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-3);
        }

        .review-author {
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
        }

        .review-text {
            color: var(--text-secondary);
            line-height: var(--line-height-relaxed);
        }

        /* Owner Card */
        .owner-card {
            padding: var(--spacing-5);
            background: var(--gray-50);
            border-radius: var(--radius-xl);
            margin-top: var(--spacing-6);
        }

        .owner-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-4);
            margin-bottom: var(--spacing-4);
        }

        .owner-avatar {
            width: 64px;
            height: 64px;
            border-radius: var(--radius-full);
            background: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
        }

        .owner-info h4 {
            margin-bottom: var(--spacing-1);
        }

        .owner-info p {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            margin: 0;
        }

        .owner-stats {
            display: flex;
            gap: var(--spacing-6);
            padding: var(--spacing-3) 0;
            border-top: 1px solid var(--border-light);
            border-bottom: 1px solid var(--border-light);
            margin-bottom: var(--spacing-4);
        }

        .owner-stats div {
            text-align: center;
        }

        .owner-stats strong {
            display: block;
            font-size: var(--font-size-lg);
            color: var(--text-primary);
        }

        .owner-stats span {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }

        /* Sidebar */
        .local-sidebar {
            position: sticky;
            top: calc(var(--header-height) + var(--spacing-4));
            height: fit-content;
        }

        .booking-card {
            background: var(--white);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-6);
            border: 1px solid var(--border-light);
        }

        .booking-price {
            display: flex;
            align-items: baseline;
            gap: var(--spacing-2);
            margin-bottom: var(--spacing-5);
        }

        .booking-price .amount {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            color: var(--primary);
        }

        .booking-price .note {
            color: var(--text-muted);
        }

        .booking-form {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-4);
        }

        .booking-form label {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            margin-bottom: var(--spacing-1);
            display: block;
        }

        .price-breakdown {
            padding: var(--spacing-4);
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            margin: var(--spacing-4) 0;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-2) 0;
            font-size: var(--font-size-sm);
        }

        .price-row.total {
            border-top: 1px solid var(--border-light);
            margin-top: var(--spacing-2);
            padding-top: var(--spacing-3);
            font-weight: var(--font-weight-semibold);
        }

        .price-row.total span:last-child {
            color: var(--primary);
            font-size: var(--font-size-lg);
        }

        .booking-actions {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-3);
        }

        .share-actions {
            display: flex;
            justify-content: center;
            gap: var(--spacing-4);
            margin-top: var(--spacing-4);
            padding-top: var(--spacing-4);
            border-top: 1px solid var(--border-light);
        }

        .share-actions button {
            padding: var(--spacing-2);
            color: var(--text-muted);
            cursor: pointer;
            transition: color var(--transition-fast);
        }

        .share-actions button:hover {
            color: var(--primary);
        }

        /* Policies */
        .policies-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-3);
        }

        .policy-item {
            display: flex;
            gap: var(--spacing-3);
            padding: var(--spacing-3);
            background: var(--gray-50);
            border-radius: var(--radius-md);
        }

        .policy-item i {
            color: var(--success);
            margin-top: 2px;
        }

        .policy-item p {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin: 0;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .local-content {
                grid-template-columns: 1fr;
            }

            .local-sidebar {
                position: static;
            }

            .gallery-grid {
                grid-template-columns: 1fr;
                max-height: none;
            }

            .gallery-main {
                height: 300px;
            }

            .gallery-side {
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto;
                height: 150px;
            }

            .amenities-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .availability-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .amenities-grid {
                grid-template-columns: 1fr 1fr;
            }

            .availability-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .local-meta {
                flex-direction: column;
                gap: var(--spacing-3);
            }
        }
    </style>
</head>
<body>
    <div id="app" class="local-page">
        <!-- Header -->
        <header class="header" id="header">
            <div class="container">
                <nav class="nav">
                    <a href="../index.html" class="logo">
                        <span class="logo-icon">üéâ</span>
                        <span class="logo-text">Eventify</span>
                        <span class="logo-badge">Per√∫</span>
                    </a>
                    <ul class="nav-menu" id="navMenu">
                        <li><a href="../index.html" class="nav-link">Inicio</a></li>
                        <li><a href="locales.html" class="nav-link active">Locales</a></li>
                        <li><a href="servicios.html" class="nav-link">Servicios</a></li>
                        <li><a href="paquetes.html" class="nav-link">Paquetes</a></li>
                    </ul>
                    <div class="nav-actions">
                        <button class="btn btn-ghost" onclick="openAuthModal('login')">
                            <i class="fas fa-user"></i>
                            <span>Ingresar</span>
                        </button>
                        <button class="nav-toggle" id="navToggle" aria-label="Men√∫">
                            <span></span><span></span><span></span>
                        </button>
                    </div>
                </nav>
            </div>
        </header>

        <!-- Gallery Section -->
        <section class="gallery-section">
            <div class="container">
                <div class="gallery-grid" id="galleryGrid">
                    <!-- Gallery loaded via JS -->
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <div class="container">
            <div class="local-content">
                <!-- Main Info -->
                <main class="local-main" id="localMain">
                    <!-- Content loaded via JS -->
                </main>

                <!-- Sidebar -->
                <aside class="local-sidebar">
                    <div class="booking-card" id="bookingCard">
                        <!-- Booking form loaded via JS -->
                    </div>
                </aside>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="footer-bottom" style="border: none; padding: var(--spacing-6) 0;">
                    <p>&copy; 2025 Eventify Per√∫. Todos los derechos reservados.</p>
                </div>
            </div>
        </footer>

        <!-- Chatbot -->
        <div class="chatbot" id="chatbot">
            <button class="chatbot-trigger" id="chatbotTrigger"><i class="fas fa-comments"></i></button>
            <div class="chatbot-window" id="chatbotWindow">
                <div class="chatbot-header">
                    <div class="chatbot-avatar"><img src="../assets/images/eventbot-avatar.svg" alt="EventBot"><span class="status-dot"></span></div>
                    <div class="chatbot-info"><strong>EventBot</strong><span>Tu asistente 24/7</span></div>
                    <button class="chatbot-close" id="chatbotClose"><i class="fas fa-times"></i></button>
                </div>
                <div class="chatbot-messages" id="chatbotMessages"></div>
                <div class="chatbot-quick-actions" id="quickActions">
                    <button class="quick-action" data-action="precios">üí∞ Precios</button>
                    <button class="quick-action" data-action="disponibilidad">üìÖ Disponibilidad</button>
                </div>
                <form class="chatbot-input" id="chatbotForm">
                    <input type="text" id="chatInput" placeholder="Escribe tu mensaje..." autocomplete="off">
                    <button type="submit"><i class="fas fa-paper-plane"></i></button>
                </form>
            </div>
        </div>

        <!-- Auth Modal -->
        <div class="modal" id="authModal">
            <div class="modal-overlay"></div>
            <div class="modal-content auth-modal">
                <button class="modal-close" aria-label="Cerrar"><i class="fas fa-times"></i></button>
                <div class="auth-form" id="loginForm">
                    <div class="auth-header">
                        <h2>Bienvenido de vuelta</h2>
                        <p>Ingresa a tu cuenta para continuar</p>
                    </div>
                    <form id="loginFormElement">
                        <div class="form-group">
                            <label for="loginEmail">Correo electr√≥nico</label>
                            <div class="input-icon">
                                <i class="fas fa-envelope"></i>
                                <input type="email" id="loginEmail" placeholder="tu@correo.com" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Contrase√±a</label>
                            <div class="input-icon">
                                <i class="fas fa-lock"></i>
                                <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block btn-lg">Ingresar</button>
                    </form>
                    <p class="auth-switch">¬øNo tienes cuenta? <a href="#" onclick="switchAuthForm('register')">Reg√≠strate</a></p>
                </div>
                <div class="auth-form hidden" id="registerForm">
                    <div class="auth-header">
                        <h2>Crea tu cuenta</h2>
                        <p>√önete a Eventify</p>
                    </div>
                    <form id="registerFormElement">
                        <div class="form-row-2">
                            <div class="form-group">
                                <label for="registerName">Nombre</label>
                                <input type="text" id="registerName" placeholder="Tu nombre" required>
                            </div>
                            <div class="form-group">
                                <label for="registerLastname">Apellido</label>
                                <input type="text" id="registerLastname" placeholder="Tu apellido" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="registerEmail">Correo electr√≥nico</label>
                            <div class="input-icon">
                                <i class="fas fa-envelope"></i>
                                <input type="email" id="registerEmail" placeholder="tu@correo.com" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="registerPhone">Tel√©fono</label>
                            <div class="input-icon">
                                <i class="fas fa-phone"></i>
                                <input type="tel" id="registerPhone" placeholder="999 888 777" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="registerPassword">Contrase√±a</label>
                            <div class="input-icon">
                                <i class="fas fa-lock"></i>
                                <input type="password" id="registerPassword" placeholder="M√≠nimo 8 caracteres" required>
                            </div>
                        </div>
                        <label class="checkbox">
                            <input type="checkbox" id="acceptTerms" required>
                            <span>Acepto los <a href="terminos.html">T√©rminos y Condiciones</a></span>
                        </label>
                        <button type="submit" class="btn btn-primary btn-block btn-lg">Crear cuenta</button>
                    </form>
                    <p class="auth-switch">¬øYa tienes cuenta? <a href="#" onclick="switchAuthForm('login')">Inicia sesi√≥n</a></p>
                </div>
            </div>
        </div>

        <div class="toast-container" id="toastContainer"></div>

        <!-- Modal de Solicitud de Reserva -->
        <div class="modal" id="bookingModal">
            <div class="modal-overlay" onclick="closeBookingModal()"></div>
            <div class="modal-content auth-modal">
                <button class="modal-close" onclick="closeBookingModal()" aria-label="Cerrar"><i class="fas fa-times"></i></button>
                <div class="auth-header">
                    <h2><i class="fas fa-calendar-check" style="color: var(--primary); margin-right: 8px;"></i>Solicitar Reserva</h2>
                    <p id="bookingModalSubtitle">Completa tus datos y te contactaremos en menos de 24 horas</p>
                </div>
                <form id="bookingRequestForm" onsubmit="submitBookingRequest(event)">
                    <div class="booking-summary" style="background: var(--gray-50); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                        <h4 id="modalLocalName" style="margin: 0 0 8px 0; color: var(--gray-900);"></h4>
                        <div style="display: flex; gap: 16px; flex-wrap: wrap; font-size: 14px; color: var(--gray-600);">
                            <span><i class="fas fa-calendar"></i> <span id="modalDate"></span></span>
                            <span><i class="fas fa-users"></i> <span id="modalGuests"></span> invitados</span>
                            <span><i class="fas fa-tag"></i> <span id="modalEventType"></span></span>
                        </div>
                        <div style="margin-top: 12px; font-size: 18px; font-weight: 600; color: var(--primary);">
                            Total estimado: <span id="modalTotal"></span>
                        </div>
                    </div>
                    <div class="form-row-2">
                        <div class="form-group">
                            <label for="bookingName">Nombre completo *</label>
                            <input type="text" id="bookingName" placeholder="Tu nombre" required>
                        </div>
                        <div class="form-group">
                            <label for="bookingPhone">Tel√©fono / WhatsApp *</label>
                            <input type="tel" id="bookingPhone" placeholder="999 888 777" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="bookingEmail">Correo electr√≥nico *</label>
                        <div class="input-icon">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="bookingEmail" placeholder="tu@correo.com" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="bookingMessage">Mensaje adicional (opcional)</label>
                        <textarea id="bookingMessage" rows="3" placeholder="¬øTienes alguna pregunta o requerimiento especial?" style="width: 100%; padding: 12px; border: 1px solid var(--gray-200); border-radius: 8px; resize: vertical;"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block btn-lg" id="submitBookingBtn">
                        <i class="fas fa-paper-plane"></i> Enviar Solicitud de Reserva
                    </button>
                    <p style="text-align: center; margin-top: 12px; font-size: 13px; color: var(--gray-500);">
                        <i class="fas fa-shield-alt"></i> Tus datos est√°n protegidos. Te contactaremos pronto.
                    </p>
                </form>
            </div>
        </div>

        <!-- Modal de Solicitar Visita -->
        <div class="modal" id="visitModal">
            <div class="modal-overlay" onclick="closeVisitModal()"></div>
            <div class="modal-content auth-modal">
                <button class="modal-close" onclick="closeVisitModal()" aria-label="Cerrar"><i class="fas fa-times"></i></button>
                <div class="auth-header">
                    <h2><i class="fas fa-eye" style="color: var(--primary); margin-right: 8px;"></i>Solicitar Visita</h2>
                    <p>Agenda una visita para conocer el local en persona</p>
                </div>
                <form id="visitRequestForm" onsubmit="submitVisitRequest(event)">
                    <div class="form-row-2">
                        <div class="form-group">
                            <label for="visitName">Nombre completo *</label>
                            <input type="text" id="visitName" placeholder="Tu nombre" required>
                        </div>
                        <div class="form-group">
                            <label for="visitPhone">Tel√©fono / WhatsApp *</label>
                            <input type="tel" id="visitPhone" placeholder="999 888 777" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="visitEmail">Correo electr√≥nico *</label>
                        <div class="input-icon">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="visitEmail" placeholder="tu@correo.com" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="visitPreferredDate">Fecha preferida para visita</label>
                        <input type="date" id="visitPreferredDate" style="width: 100%; padding: 12px; border: 1px solid var(--gray-200); border-radius: 8px;">
                    </div>
                    <button type="submit" class="btn btn-primary btn-block btn-lg" id="submitVisitBtn">
                        <i class="fas fa-calendar-plus"></i> Solicitar Visita
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Google Sheets Integration -->
    <iframe name="gsIframe" id="gsIframe" style="display:none;"></iframe>
    <script>
        const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbxWWH_SyHWtB4Zwdd3Vj92ysHfDJxYy7fFmt1KgB_L9SZ7xzxUQRDGogXD_cSLlyOfK/exec';

        function sendToGoogleSheets(sheetName, data) {
            return new Promise((resolve) => {
                try {
                    const flatData = { sheet: sheetName, ...data };
                    const params = new URLSearchParams(flatData);
                    const url = GOOGLE_SHEETS_URL + '?' + params.toString();

                    const iframe = document.getElementById('gsIframe');
                    iframe.src = url;
                    iframe.onload = () => resolve(true);
                    iframe.onerror = () => resolve(true);
                    setTimeout(() => resolve(true), 5000);

                    console.log('Datos enviados a Google Sheets:', sheetName, data);
                } catch (error) {
                    console.error('Error Google Sheets:', error);
                    resolve(false);
                }
            });
        }
    </script>

    <!-- Analytics -->
    <script src="../js/analytics.js"></script>

    <!-- Scripts -->
    <script src="../js/data/locales.js"></script>
    <script src="../js/data/servicios.js"></script>
    <script src="../js/utils/helpers.js"></script>
    <script src="../js/components/header.js"></script>
    <script src="../js/components/chatbot.js"></script>
    <script src="../js/components/auth.js"></script>
    <script src="../js/components/cards.js"></script>
    <script src="../js/components/toast.js"></script>
    <script src="../js/app.js"></script>

    <script>
        let currentLocale = null;

        document.addEventListener('DOMContentLoaded', () => {
            const slug = getUrlParam('slug');
            if (slug) {
                loadLocaleDetail(slug);
            } else {
                // Default to first locale
                loadLocaleDetail(LOCALES_DATA[0].slug);
            }
        });

        function loadLocaleDetail(slug) {
            currentLocale = getLocaleBySlug(slug);

            if (!currentLocale) {
                showToast('error', 'Error', 'Local no encontrado');
                window.location.href = 'locales.html';
                return;
            }

            // Update page title
            document.title = `${currentLocale.name} | Eventify Per√∫`;

            // Render sections
            renderGallery();
            renderMainContent();
            renderBookingCard();
        }

        function renderGallery() {
            const gallery = document.getElementById('galleryGrid');
            gallery.innerHTML = `
                <div class="gallery-main">
                    <div class="placeholder">${currentLocale.icon}</div>
                </div>
                <div class="gallery-side">
                    <div class="gallery-thumb">
                        <div class="placeholder">üéâ</div>
                    </div>
                    <div class="gallery-thumb">
                        <div class="placeholder">‚ú®</div>
                        <div class="gallery-more">+5 fotos</div>
                    </div>
                </div>
            `;
        }

        function renderMainContent() {
            const main = document.getElementById('localMain');
            const starsHtml = generateStars(currentLocale.rating);
            const days = ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'];
            const dayKeys = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];

            main.innerHTML = `
                <!-- Header -->
                <div class="local-header">
                    <div class="local-badges">
                        ${currentLocale.badges.map(badge => `<span class="badge badge-${badge === 'Verificado' ? 'success' : 'primary'}">${badge}</span>`).join('')}
                    </div>
                    <h1 class="local-title">${currentLocale.name}</h1>
                    <p class="local-location">
                        <i class="fas fa-map-marker-alt"></i>
                        ${currentLocale.location.address}, ${currentLocale.location.district}, ${currentLocale.location.city}
                    </p>
                    <div class="local-meta">
                        <div class="meta-item">
                            <i class="fas fa-users"></i>
                            <div>
                                <strong>${currentLocale.capacity.min}-${currentLocale.capacity.max}</strong>
                                <span>personas</span>
                            </div>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-star"></i>
                            <div>
                                <strong>${currentLocale.rating}</strong>
                                <span>(${currentLocale.reviewsCount} rese√±as)</span>
                            </div>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-tag"></i>
                            <div>
                                <strong>${LOCALE_CATEGORIES[currentLocale.category]?.name || currentLocale.category}</strong>
                                <span>categor√≠a</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Description -->
                <section class="info-section">
                    <h2><i class="fas fa-info-circle"></i> Descripci√≥n</h2>
                    <p class="description">${currentLocale.description}</p>
                </section>

                <!-- Amenities -->
                <section class="info-section">
                    <h2><i class="fas fa-check-circle"></i> Servicios Incluidos</h2>
                    <div class="amenities-grid">
                        ${currentLocale.amenities.map(amenity => `
                            <div class="amenity-item">
                                <i class="fas ${amenity.icon}"></i>
                                <span>${amenity.name}</span>
                            </div>
                        `).join('')}
                    </div>
                </section>

                <!-- Availability -->
                <section class="info-section">
                    <h2><i class="fas fa-calendar-alt"></i> Disponibilidad</h2>
                    <div class="availability-grid">
                        ${dayKeys.map((day, i) => {
                            const avail = currentLocale.availability[day];
                            return `
                                <div class="day-slot ${avail.available ? 'available' : 'unavailable'}">
                                    <span class="day-name">${days[i]}</span>
                                    <span class="hours">${avail.available ? avail.hours : 'Cerrado'}</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </section>

                <!-- Event Types -->
                <section class="info-section">
                    <h2><i class="fas fa-calendar-check"></i> Ideal para</h2>
                    <div style="display: flex; flex-wrap: wrap; gap: var(--spacing-2);">
                        ${currentLocale.eventTypes.map(type => {
                            const eventInfo = EVENT_TYPES[type] || { name: type, icon: 'üéâ' };
                            return `<span class="badge badge-primary">${eventInfo.icon} ${eventInfo.name}</span>`;
                        }).join('')}
                    </div>
                </section>

                <!-- Policies -->
                <section class="info-section">
                    <h2><i class="fas fa-file-contract"></i> Pol√≠ticas</h2>
                    <div class="policies-list">
                        <div class="policy-item">
                            <i class="fas fa-undo"></i>
                            <p><strong>Cancelaci√≥n:</strong> ${currentLocale.policies.cancellation}</p>
                        </div>
                        <div class="policy-item">
                            <i class="fas fa-money-bill"></i>
                            <p><strong>Pago:</strong> ${currentLocale.policies.deposit}</p>
                        </div>
                        ${currentLocale.policies.rules.map(rule => `
                            <div class="policy-item">
                                <i class="fas fa-check"></i>
                                <p>${rule}</p>
                            </div>
                        `).join('')}
                    </div>
                </section>

                <!-- Reviews -->
                <section class="info-section">
                    <div class="reviews-header">
                        <h2><i class="fas fa-star"></i> Rese√±as</h2>
                        <div class="rating-summary">
                            <span class="rating-big">${currentLocale.rating}</span>
                            <div class="rating-details">
                                <div class="rating-stars">${starsHtml}</div>
                                <span style="color: var(--text-muted); font-size: var(--font-size-sm);">${currentLocale.reviewsCount} rese√±as</span>
                            </div>
                        </div>
                    </div>

                    <div class="review-card">
                        <div class="review-header">
                            <div class="review-author">
                                <div class="avatar">MG</div>
                                <div>
                                    <strong>Mar√≠a Garc√≠a</strong>
                                    <p style="color: var(--text-muted); font-size: var(--font-size-xs); margin: 0;">Hace 2 semanas</p>
                                </div>
                            </div>
                            <div class="rating-stars">${generateStars(5)}</div>
                        </div>
                        <p class="review-text">Excelente local, todo sali√≥ perfecto para mi evento de XV a√±os. El espacio es hermoso y el personal muy atento. Totalmente recomendado.</p>
                    </div>

                    <div class="review-card">
                        <div class="review-header">
                            <div class="review-author">
                                <div class="avatar" style="background: var(--secondary);">JR</div>
                                <div>
                                    <strong>Juan Rodr√≠guez</strong>
                                    <p style="color: var(--text-muted); font-size: var(--font-size-xs); margin: 0;">Hace 1 mes</p>
                                </div>
                            </div>
                            <div class="rating-stars">${generateStars(4.5)}</div>
                        </div>
                        <p class="review-text">Muy buen local para eventos corporativos. Amplio estacionamiento y buena ubicaci√≥n. El √∫nico detalle fue el aire acondicionado que tard√≥ un poco en enfriar.</p>
                    </div>

                    <button class="btn btn-outline" style="margin-top: var(--spacing-4);">
                        Ver todas las rese√±as (${currentLocale.reviewsCount})
                    </button>
                </section>

                <!-- Owner -->
                <div class="owner-card">
                    <div class="owner-header">
                        <div class="owner-avatar">${currentLocale.owner.avatar}</div>
                        <div class="owner-info">
                            <h4>${currentLocale.owner.name}</h4>
                            <p>Propietario del local</p>
                        </div>
                    </div>
                    <div class="owner-stats">
                        <div>
                            <strong>${currentLocale.owner.responseRate}%</strong>
                            <span>Respuesta</span>
                        </div>
                        <div>
                            <strong>${currentLocale.owner.responseTime}</strong>
                            <span>Tiempo respuesta</span>
                        </div>
                        <div>
                            <strong>${currentLocale.reviewsCount}</strong>
                            <span>Rese√±as</span>
                        </div>
                    </div>
                    <button class="btn btn-outline btn-block" onclick="contactOwner()">
                        <i class="fab fa-whatsapp"></i> Contactar por WhatsApp
                    </button>
                </div>
            `;
        }

        function renderBookingCard() {
            const card = document.getElementById('bookingCard');
            const minDate = new Date().toISOString().split('T')[0];

            card.innerHTML = `
                <div class="booking-price">
                    <span class="amount">${formatPrice(currentLocale.price.base)}</span>
                    <span class="note">por evento</span>
                </div>

                <form class="booking-form" id="bookingForm" onsubmit="handleBooking(event)">
                    <div class="form-group">
                        <label>Fecha del evento</label>
                        <input type="date" id="bookingDate" min="${minDate}" required>
                    </div>

                    <div class="form-group">
                        <label>Tipo de evento</label>
                        <select id="bookingEventType" required>
                            <option value="">Selecciona...</option>
                            ${currentLocale.eventTypes.map(type => {
                                const info = EVENT_TYPES[type] || { name: type, icon: 'üéâ' };
                                return `<option value="${type}">${info.icon} ${info.name}</option>`;
                            }).join('')}
                        </select>
                    </div>

                    <div class="form-group">
                        <label>N√∫mero de invitados</label>
                        <input type="number" id="bookingGuests" min="${currentLocale.capacity.min}" max="${currentLocale.capacity.max}" placeholder="${currentLocale.capacity.min}-${currentLocale.capacity.max}" required>
                    </div>

                    <div class="price-breakdown">
                        <div class="price-row">
                            <span>Alquiler del local</span>
                            <span>${formatPrice(currentLocale.price.base)}</span>
                        </div>
                        <div class="price-row">
                            <span>Dep√≥sito de garant√≠a</span>
                            <span>${formatPrice(currentLocale.price.deposit)}</span>
                        </div>
                        <div class="price-row">
                            <span>Comisi√≥n Eventify</span>
                            <span>${formatPrice(currentLocale.price.base * 0.12)}</span>
                        </div>
                        <div class="price-row total">
                            <span>Total</span>
                            <span>${formatPrice(currentLocale.price.base + currentLocale.price.deposit + currentLocale.price.base * 0.12)}</span>
                        </div>
                    </div>

                    <div class="booking-actions">
                        <button type="submit" class="btn btn-primary btn-lg btn-block">
                            <i class="fas fa-calendar-check"></i>
                            Reservar Ahora
                        </button>
                        <button type="button" class="btn btn-outline btn-block" onclick="requestVisit()">
                            <i class="fas fa-eye"></i>
                            Solicitar Visita
                        </button>
                    </div>
                </form>

                <div class="share-actions">
                    <button onclick="shareLocal()" title="Compartir">
                        <i class="fas fa-share-alt"></i>
                    </button>
                    <button onclick="toggleFavoriteLocal()" title="Guardar" id="favBtn">
                        <i class="far fa-heart"></i>
                    </button>
                    <button onclick="printLocal()" title="Imprimir">
                        <i class="fas fa-print"></i>
                    </button>
                </div>

                <p style="text-align: center; font-size: var(--font-size-xs); color: var(--text-muted); margin-top: var(--spacing-4);">
                    <i class="fas fa-shield-alt"></i> Pago seguro con garant√≠a de devoluci√≥n
                </p>
            `;
        }

        // Variables para almacenar datos de reserva temporalmente
        let pendingBookingData = {};

        function handleBooking(e) {
            e.preventDefault();

            const date = document.getElementById('bookingDate').value;
            const eventType = document.getElementById('bookingEventType').value;
            const guests = document.getElementById('bookingGuests').value;

            if (!date) {
                showToast('error', 'Fecha requerida', 'Selecciona una fecha para tu evento');
                return;
            }

            // Guardar datos temporalmente
            const total = currentLocale.price.base + currentLocale.price.deposit + (currentLocale.price.base * 0.12);
            pendingBookingData = {
                local: currentLocale.name,
                localSlug: currentLocale.slug,
                fecha: date,
                fechaFormateada: formatDate(date, 'long'),
                tipoEvento: eventType,
                tipoEventoNombre: EVENT_TYPES[eventType]?.name || eventType,
                invitados: guests,
                precioBase: currentLocale.price.base,
                deposito: currentLocale.price.deposit,
                total: total
            };

            // Llenar el modal con los datos
            document.getElementById('modalLocalName').textContent = currentLocale.name;
            document.getElementById('modalDate').textContent = formatDate(date, 'long');
            document.getElementById('modalGuests').textContent = guests;
            document.getElementById('modalEventType').textContent = EVENT_TYPES[eventType]?.name || eventType;
            document.getElementById('modalTotal').textContent = formatPrice(total);

            // Abrir modal
            openBookingModal();
        }

        function openBookingModal() {
            document.getElementById('bookingModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeBookingModal() {
            document.getElementById('bookingModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        async function submitBookingRequest(e) {
            e.preventDefault();

            const btn = document.getElementById('submitBookingBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
            btn.disabled = true;

            const formData = {
                id: 'RES-' + Date.now(),
                nombre: document.getElementById('bookingName').value,
                telefono: document.getElementById('bookingPhone').value,
                contacto: document.getElementById('bookingEmail').value,
                mensaje: document.getElementById('bookingMessage').value || '',
                local: pendingBookingData.local,
                localSlug: pendingBookingData.localSlug,
                fechaEvento: pendingBookingData.fecha,
                tipoEvento: pendingBookingData.tipoEventoNombre,
                invitados: pendingBookingData.invitados,
                precioEstimado: pendingBookingData.total,
                estado: 'pendiente',
                origen: 'web',
                fecha: new Date().toLocaleDateString('es-PE'),
                hora: new Date().toLocaleTimeString('es-PE'),
                timestamp: new Date().toISOString()
            };

            try {
                await sendToGoogleSheets('Reservas', formData);

                closeBookingModal();
                showToast('success', '¬°Solicitud enviada!', 'Te contactaremos en menos de 24 horas para confirmar tu reserva');

                // Limpiar formulario
                document.getElementById('bookingRequestForm').reset();

            } catch (error) {
                console.error('Error al enviar:', error);
                showToast('error', 'Error', 'Hubo un problema. Intenta de nuevo o cont√°ctanos por WhatsApp');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        function contactOwner() {
            const message = `Hola, me interesa el local "${currentLocale.name}" publicado en Eventify. ¬øPodr√≠an darme m√°s informaci√≥n?`;
            const url = formatWhatsAppLink(currentLocale.contact.whatsapp, message);
            window.open(url, '_blank');
        }

        function openVisitModal() {
            document.getElementById('visitModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeVisitModal() {
            document.getElementById('visitModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function requestVisit() {
            openVisitModal();
        }

        async function submitVisitRequest(e) {
            e.preventDefault();

            const btn = document.getElementById('submitVisitBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
            btn.disabled = true;

            const formData = {
                id: 'VIS-' + Date.now(),
                nombre: document.getElementById('visitName').value,
                telefono: document.getElementById('visitPhone').value,
                contacto: document.getElementById('visitEmail').value,
                fechaPreferida: document.getElementById('visitPreferredDate').value || 'Por definir',
                local: currentLocale.name,
                localSlug: currentLocale.slug,
                tipoSolicitud: 'visita',
                estado: 'pendiente',
                fecha: new Date().toLocaleDateString('es-PE'),
                hora: new Date().toLocaleTimeString('es-PE'),
                timestamp: new Date().toISOString()
            };

            try {
                await sendToGoogleSheets('Leads', formData);

                closeVisitModal();
                showToast('success', '¬°Solicitud enviada!', 'Te contactaremos pronto para coordinar tu visita');

                // Limpiar formulario
                document.getElementById('visitRequestForm').reset();

            } catch (error) {
                console.error('Error al enviar:', error);
                showToast('error', 'Error', 'Hubo un problema. Intenta de nuevo');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        function shareLocal() {
            shareContent(currentLocale.name, currentLocale.shortDescription, window.location.href);
        }

        function toggleFavoriteLocal() {
            const btn = document.getElementById('favBtn');
            const icon = btn.querySelector('i');
            const isFavorite = icon.classList.contains('fas');

            if (isFavorite) {
                icon.classList.remove('fas');
                icon.classList.add('far');
                showToast('info', 'Eliminado', 'Eliminado de favoritos');
            } else {
                icon.classList.remove('far');
                icon.classList.add('fas');
                showToast('success', 'Guardado', 'Agregado a favoritos');
            }
        }

        function printLocal() {
            window.print();
        }
    </script>
</body>
</html>
